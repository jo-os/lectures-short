# attacks
Уязвимости и атаки на информационные системы

**Исследование сетей**

Первым этапом любой атаки является исследование (exploration, разведка) атакуемой системы.

Основные задачи исследования сети:
- построение топологии сети;
- перечисление доступных сетевых узлов;
- обнаружение сетевых служб хостов.

Основные средства исследования сети:
- анализаторы пакетов (Wireshark);
- сканеры сети (nmap);
- сканеры уязвимостей (Nessus);
- средства создания пакетов (HPing).

**NMAP: возможности**
- обнаружение хостов в сети;
- обнаружение открытых портов хоста;
- определение сетевых служб хоста;
- сканирование диапазона IP-адресов (в том числе в сети Интернет);
- автоматизация поиска и дальнейшего исследования при помощи файлов сценариев (скриптов)

**NMAP: установка**

Nmap – стандарт средств сканирования сети, поэтому установлен по умолчанию в любой ОС, ориентированной на исследования в области безопасности.

Для самостоятельной установки нужно перейти на сайт - https://nmap.org

И в разделе загрузки (Download) выбрать версию для нужной ОС - https://nmap.org/download.html

**NMAP: основные режимы сканирования**
- -sS: TCP SYN-сканирование
- -sT: TCP connect-сканирование
- -sА: TCP FIN-сканирование
- -sU: UDP-сканирование
- -sX: Xmas-сканирование
- -PR: ARP-пинг
- --traceroute: трассировка пути
- -R: разрешение имен DNS
- -n: запрещение разрешения имен DNS
- -sL: создать список хостов
**NMAP: агрессивный режим сканирования** - Агрессивный режим сканирования (-A) – наиболее часто используемый режим сканирования. Предоставляет дополнительную информацию о хосте.

**NMAP: определение версий ПО на сервере** - nmap -sV scanme.nmap.org

**Hydra** – программа для подбора паролей.

Частичный список поддерживаемых протоколов: Cisco *, FTP, HTTP-FORM-GET, HTTP-FORM-POST, HTTP-GET, HTTP-HEAD, HTTP-POST, HTTP-PROXY, HTTPS-FORM-GET, HTTPS-FORM-POST, HTTPS-GET, HTTPS-HEAD, HTTPS-POST, ICQ, IMAP, IRC, LDAP, MS-SQL, MYSQL, Oracle *, PC-Anywhere, POP3, POSTGRES, RDP, Rlogin, SAP/R3, SIP, SMB, SMTP, SNMP, SOCKS5, SSH (v1, 2), SSHKEY, Teamspeak (TS2), Telnet, VNC. Домашняя страница: https://github.com/vanhauser-thc/thc-hydra

Выполним атаку на подбор пароля:
```
hydra -L users.txt -P pass.txt 192.168.0.5 ssh
```
**ARP-spoofing** – атака, использующая особенность протокола ARP, которая позволяет обработать ARP-ответ без предварительного ARP- запроса (протокол ARP не сохраняет свое состояние, stateless protocol). Данная атака позволяет злоумышленнику перехватывать трафик между узлами локальной сети и является разновидностью MITM-атак (Man In The Middle, человек посередине).

**MITM (Man In The Middle, человек посередине, атака посредника)** – атака, в результате которой атакующий скрытно принимает и передает информацию между двумя узлами. При этом атакуемые узлы считают, что общаются друг с другом напрямую

**DoS (Denial of Service, отказ в обслуживании)** – атака, направленная на исчерпание одного или нескольких ресурсов системы («перегрузка системы»). Результатом такой атаки является прекращение работы системы либо ее значительное замедление.

**DDoS (Distributed Denial of Service, распределенный по источникам отказ в обслуживании)** – вариант DoS-атаки, в котором целевая система атакуется сразу из множества источников. DDoS – атака, в результате которое большое количество сетевых узлов устраивает DoS-атаку на одну цель. Чаще всего для таких атак создаются ботнеты (сети из большого количества устройств под управлением атакующего)

**DDoS: реальные атаки**

В феврале 2020 года на Amazon Web Services была осуществлена одна из самых больших DDoS-атак за всю историю. Атака продолжалась три дня и в своем пике достигала трафика в 2,3 Тб/с 19 сентября 2016 года один из самых больших европейских хостинг- провайдеров OVH (примерно 18 million приложения для более чем миллиона клиентов) был атакован ботнетом Mirai состоящим из 145,000 узлов, генерирующим трафик до 1.1 Тб\с в течении семи дней

21 октября 2016 один из основных DNS-провайдеров Dyn был атакован тем же Mirai. В этой атаке трафик достига 1,5 Тб\с. В результате почти все службы Dyn оказались заблокированы, что отразилось на работе таких гигантов как GitHub, HBO, Twitter, Reddit, PayPal, Netflix и Airbnb.

28 февраля 2018 года был атакован GitHub. Трафик доходил до 1,35 Тб\с и длился примерно 20 минут. Несмотря на то что GitHub был готов к подобного рода атакам, против нагрузки подобного масштаба «устоять» не получилось.

**DoS: slow attack**

Slow attack – тип DoS-атак, при котором трафик, идущий на сервер, довольно маленький, т.е. не оказывает никакого влияния на канал связи. Особенностью этих атак является длительное время выполнения (slow).

Теперь предположим, что кто-то решил передавать приведенный выше запрос примерно по такой временной диаграмме:
- Connection: keep-alive
- <пауза 15 минут>
- Host: 127.0.0.1:8000
- <пауза 15 минут>
- Connection: keep-alive
- <пауза 15 минут>

Более того, даже один заголовок можно передавать аналогично:
- A
- <пауза 15 минут>
- с
- <пауза 15 минут>
- с
- <пауза 15 минут>
- e ... и т.д

**DoS: slow body**

Данный тип атаки аналогичен slow headers, только в этом случае медленно передается тело запроса (может быть любым):
- ...
- body = a...a...a...a...a...a...
- ...

**DoS: range attack (Apache killer)**

Производит манипуляции с HTTP-заголовком Range. Apache 1.3.x, 2.0.0-2.0.64, 2.2.0-2.2.19 (CVE-2011-3192: Apache range header handling vulnerability)

**DoS: slow read**

Медленное чтение – данная атака аналогична медленной записи, и использует особенности протоколов HTTP и TCP. На сервере выбирается большой ресурс и, манипулируя значением окна TCP (например, приравнивая его нулю), вызывается постоянное увеличение используемой памяти.

**Metasploit**

Metasploit – один из самых популярных фреймворков (framework) для тестирования на проникновение (пентест, pentest, penetration test)*. Metasploit имеет большое количество модулей, «связанных» собственной локальной БД, и развитое сообщество. *Тестирования на проникновение – легальная и согласованная эмуляция кибератаки на систему.

Metasploit появился в 2003 году, и в начале был реализован на Perl. Примерно в 2007 году был полностью переписан на Ruby и в 2009 году стал коммерческим проектом (после покупки проекта Rapid7).

Metasploit: возможности
- Сбор информации (Information Gathering, Enumeration)
- Получение доступа (Gaining Access)
- Повышение привилегий (Privilege Escalation)
- Расширение присутствия/доступа (Maintaining Access)
- Маскировка присутствия (Covering Tracks)

Metasploit: модули
- Auxiliaries (вспомогательные модули)
- Exploits
- Encoders (кодировщики)
- Payloads (полезная нагрузка)
- Post (пост эксплуатация)

# host-protection
Защита хоста

**Информационная безопасность**

**Информационная безопасность (Information Security, InfoSec)** — методы защиты информации путём уменьшения информационных рисков.

**Кибербезопасность (Computer security, cybersecurity)** — методы защиты компьютерных систем, их программного и аппаратного обеспечения, хранимых и передаваемых данных от компьютерных атак

- **Субъект** — пытается получить доступ к **объекту**
- **Объект** — то, к чему ограничивается или отслеживается **доступ**
- **Доступ** — операция чтения, записи, создания, удаления, модификации и т. д.

**ИБ: свойства информации**
- Конфиденциальность — состояние информации, при котором доступ к ней возможен только со стороны авторизованных на это субъектов.
- Доступность — возможность беспрепятственного доступа к информации для субъекта, имеющего необходимые права.
- Целостность — отсутствие неправомерного искажения, добавления, удаления информации.

**ИБ: угроза безопасности информации**
- Угроза безопасности информации — совокупность условий и факторов, создающих потенциальную или реально существующую опасность нарушения информационной безопасности (ГОСТ Р 50922-96).
- Угроза = вероятность + опасность
- Наличие угрозы не подразумевает атаку на систему, но говорит о её вероятности.
- Угроза ➡ (вероятность) ➡ ущерб

**ИБ: источник угрозы безопасности информации**
- Источник угрозы безопасности информации — субъект, являющийся непосредственной причиной возникновения угрозы безопасности информации: авторизованный пользователь, злоумышленник, насекомое.
- Уязвимость информационной системы — свойство системы, обусловливающее возможность реализации угроз безопасности информации

**Защита хоста**

**Антивирус** — средство защиты, предназначенное для определения и блокирования вредоносного ПО: вирусов, троянов, червей и т. д.

Основные подходы к обнаружению вредоносного ПО:
- сигнатурный — проверка по БД индикаторов
- поиск аномалий — анализ поведения
Варианты установки:
- на хосте
- на сервере, обычно подключаются как отдельные модули

**Хостовая система обнаружения вторжений (Host-based intrusion detection system, HIDS)** — средство защиты, предназначенное для анализа событий в динамике, происходящих на хосте.

Основные подходы к обнаружению вредоносного ПО:
- наблюдение за участками памяти
- наблюдение за выбранными файлами
- наблюдение за поведением системы
- наблюдение за логами

Песочница (sandbox) — тестовая среда для запуска ПО, изолированная от основной системы.

Дистрибутивы:
- seccomp (средство ядра Linux, ограничивает системные вызовы)
- Sandboxie
- Shade sandbox

**SELinux** — это система принудительного контроля доступа, реализованная на уровне ядра.

SELinux применяет систему дополнительной маркировки объектов ОС и определяет правила доступа каждого процесса к объектам на основе присвоенных меток. Такие правила объединяются и называются политикой

Режимы работы:
- Disabled
- Enforcing — блокировка в соответствии с заданными политикам
- Permissive — логирование в соответствии с заданными политикам.

**AppArmor** — модуль ядра Linux, обеспечивающий управление доступом на основе имён. Т. е. для каждой программы создаётся свой профиль, в котором указываются уровни доступа к каталогам, программам и системным ресурсам.
```
user@user:~$ sudo apt install apparmor-profiles apparmor-utils
apparmor-profiles-extra
```
Ссылка: gitlab.com/apparmor/apparmor

AppArmor: режимы работы
- Режим обучения (сообщения о действиях приложения):
```
user@user:~$ sudo aa-complain <путь к файлу>
```
- Режим ограничения согласно профилю:
```
user@user:~$ sudo aa-enforce <путь к файлу>
```
**PAM (Pluggable Authentication Modules, подключаемые модули аутентификации)** — набор библиотек, с помощью которых можно настроить методы аутентификации пользователей.

Типы модулей PAM:
- модули учётных записей
- модули аутентификации
- модули паролей
- модули сессий

**Ограничение попыток входа**

Структура каталогов PAM:
- /etc/pam.d/ — файлы конфигураций приложений
- /lib/security/ — модули PAM
- /etc/security/ — файлы конфигураций для PAM-окружений
- /usr/share/doc/pam-*/ — документация

**Шифрование**

**eCryptfs** — это POSIX-совместимая файловая система вложенного (stacked) шифрования. eCryptfs защищает файлы для любой файловой системы, раздела и т. д.

Установка:
```
user@user:~$ sudo apt install ecryptfs-utils
```
Шифрование домашнего каталога

Создание нового пользователя:
```
user@user:~$ sudo adduser --encrypt-home user2
```
Проверка шифрования:
```
user@user:~$ su - user2
user2@user:~$ touch 123, 456
user2@user:~$ exit
user@user:~$ sudo ls /home/user2/
Access-Your-Private-Data.desktop README.txt
```
Миграция домашнего каталога пользователя:
```
user@user:~$ sudo ecryptfs-migrate-home -u user1
```
Шифрование раздела swap:
```
user@user:~$ sudo ecryptfs-setup-swap
```
Информация для восстановления:
```
user@user:~$ ecryptfs-unwrap-passphrase
```
**LUKS (Linux Unified Key Setup)** — спецификация формата шифрования дисков, используемая в ОС Linux. При помощи LUKS могут быть зашифрованы диски, работающие в ОС Linux как в настольных компьютерах, так и в разнообразных устройствах, например, сетевых накопителях

**Установка LUKS**

Подготовка диска:
```
user@user:~$ sudo apt install gparted
```
Установка LUKS (должна быть установлено по умолчанию):
```
user@user:~$ sudo apt-get install cryptsetup
```
Проверка установки:
```
user@user:~$ cryptsetup --version
```
**Шифрование раздела LUKS**

Подготовка раздела (luksFormat):
```
user@user:~$ sudo cryptsetup -y -v --type luks2 luksFormat /dev/sdb1
```
Монтирование раздела:
```
user@user:~$ sudo cryptsetup luksOpen /dev/sdb1 disk
user@user:~$ ls /dev/mapper/disk
```
Форматирование раздела:
```
user@user:~$ sudo dd if=/dev/zero of=/dev/mapper/disk
user@user:~$ sudo mkfs.ext4 /dev/mapper/disk
```
Шифрование раздела LUKS

Монтирование «открытого» раздела:
```
user@user:~$ mkdir .secret
user@user:~$ sudo mount /dev/mapper/disk .secret/
```
Завершение работы:
```
user@user:~$ sudo umount .secret
user@user:~$ sudo cryptsetup luksClose disk
```

# network-protection
Защита сети

**Межсетевые экраны**

Межсетевой экран (файрвол, firewall; брандмауэр, brandmauer) — программный или программно-аппаратный модуль, осуществляющий блокирование сетевого трафика по заданным правилам или алгоритмам.

Типы межсетевых экранов:
- пакетный фильтр
- stateful firewall
- firewall NG

**Система Обнаружения Вторжений (Intrusion Detection System, IDS)** — программное или аппаратное решение, определяющее вредоносную активность в системе или сетевом трафике.

**Система Предотвращения Вторжений (Intrusion Prevention Systems, IPS)** — программное или аппаратное решение, предотвращающее вредоносную активность в системе или сетевом трафике

**СОВ: типы СОВ**

По подключению:
- сетевая СОВ (Network-based IDS, NIDS)
- локальная СОВ (Host-based IDS, HIDS)
По методу обнаружения аномалий:
- сигнатурный поиск (Signature-based detection)
- статистическое определение аномалий (Statistical anomaly-based detection)

**СОВ: недостатки СОВ**
- Наличие ложно-позитивных срабатываний
- Необходимо постоянное обновление правил
- Существует временной лаг между появлением уязвимостей и созданием правил для их обнаружения
- Невозможна обработка зашифрованного трафика
- Почти невозможно определить уязвимости, вызванные неправильной настройкой: слабая аутентификации и т. д

**Suricata** — сетевая IDS с открытым исходным кодом, разрабатываемая Open Security Foundation (OISF)
- Сайт: suricata-ids.org
- Исходный код: github.com/OISF/suricata

**Suricata: установка**
```
user@user:~$ sudo apt install software-properties-common
user@user:~$ sudo add-apt-repository ppa:oisf/suricata-stable
user@user:~$ sudo apt update
user@user:~$ sudo apt install suricata
user@user:~$ sudo suricata-update
```
Проверка установки:
```
user@user:~$ sudo systemctl status suricata
```
**Suricata: настройка**
```
user@user:~$ sudo nano /etc/suricata/suricata.yaml
```
И меняем значение параметра EXTERNAL_NET на "any"
```
user@user:~$ sudo systemctl restart suricata
```
Лог-файлы:
```
user@user:~$ sudo tail /var/log/suricata/suricata.log
user@user:~$ sudo tail /var/log/suricata/stats.log
```
**Suricata: запуск**
```
ubuntu@ubuntu:~$ sudo suricata -c /etc/suricata/suricata.yaml -i enp0s8 - где параметр “i” указывает прослушиваемый интерфейс
```
откроем лог-файл, в котором будут отображаться предупреждения:
```
ubuntu@ubuntu:~$ sudo tail -f /var/log/suricata/fast.log
```

**ARP-spoofing** — атака, использующая особенность протокола ARP, которая позволяет обработать ARP-ответ без предварительного ARP- запроса. Протокол ARP не сохраняет своё состояние, stateless protocol.
Такая атака позволяет злоумышленнику перехватывать трафик между узлами локальной сети и является разновидностью MITM-атак (Man In The Middle, человек посередине)

**MITM** (Man In The Middle, человек посередине, атака посредника) — атака, в результате которой атакующий скрытно принимает и передаёт информацию между двумя узлами. При этом атакуемые узлы считают, что общаются друг с другом напряму

**ARP-spoofing: статические arp-записи**

Плюсы:
- записи, добавленные в ARP-таблицу вручную, имеют приоритет над динамическими
- протокол ARP можно вообще отключить
Минусы:
- на каждом хосте нужно создать ARP-таблицу из N-1 записей
- при каждой замене оборудования или подключении нового, нужно перенастраивать все хосты

**ARP-spoofing: защита на уровне ядра ОС**

Для ядер Linux/FreeBSD существует патч, позволяющий значительно понизить вероятность успешного выполнения ARP-spoofing.

Метод состоит в следующем:
1. При изменении MAC-адрес посылается ARP-запрос, требующий всем хостам сообщить свои MAC-адреса
2. Если выполняется атака, то по дублированию ответов она будет обнаружена
3. Если изменение MAC-адреса произошло стандартно, то ответа, содержащего старый MAC-адрес, не будет

**ARP-spoofing: VLAN**

Разбиение сети при помощи VLAN не предотвращает атаку ARP-spoofing, но ограничивает её развитие. ARP-запросы не могут переходить из одного VLAN в другой. Частным случаем, неприменимым в реальных офисных сетях, является создание VLAN на каждый порт коммутатора и добавление в него только одного хоста. В такой ситуации ARP-spoofing не имеет смысла.

**ARP-spoofing: DAI**

Динамическая проверка ARP (Dynamic ARP inspection, DAI) — функция защиты от ARP-атак на стороне коммутатора. Для правильной работы DAI на коммутаторе необходимо указать доверенные (другой коммутатор) и ненадёжные (клиенты) порты.

Коммутатор проверяет соответствие IP- и MAC-адресов на ненадёжных портах по:
- базе данных DHCP
- статическим записям

**ARP-spoofing: защита на прикладном уровне**
- XArp — программа, отслеживающая соответствие между IP и MAC- адресами. В случае обнаружения несоответствия, сообщает об этом пользователю.
- XArp сначала анализирует ARP-таблицу, запоминает все полученные ARP-ответы и создаёт свою собственную таблицу IP- и MAC-адресов. Если это соответствие нарушается или в сети появляются новые адреса, об этом будет выдано сообщение в системный журнал. Защиты на прикладном уровне лучше всего запускать на SPAN- интерфейсе

**Fail2Ban: ограничение скорости перебора**

Самым простым решением ограничения скорости перебора паролей, является ограничение в доступе, или бан, для адреса, с которого производится атака.

Для решения этой задачи существуют:
- Fail2Ban
- ipban
- DenyHosts

**Fail2Ban** — одна из узкоспециализированных систем обнаружения вторжений (СОВ, Intrusion Prevention Software, IPS). Fail2Ban сканирует лог-файлы, находит в них странное сетевое поведение, например, ошибки набора пароля, и блокирует подозрительные адреса IP-адреса на заданное время

**Web-трафик**
- Web-трафик сейчас составляет большую часть трафика в корпоративных сетях
- Web-трафик бывает двух типов:
- - исходящий — сотрудники компании выходят в интернет
- - входящий — пользователи из интернета подключаются к публикуемым web-порталам

**Защита исходящего трафика**

Для защиты исходящего трафика применяются прокси-сервера. Типовые функции: работа с HTTPs, антивирус, URL фильтрация (категории сайтов), возможность фильтрации по типу файлов

**Защита входящего трафика**

Для защиты входящего web-трафика применяются Web Application Firewall (WAF):
- обеспечивает комплексную защиту от атак на веб-приложения
- учитывает логику работы веб-приложений: сессии, cookies и т. д.
- защищает веб-приложения лучше межсетевых экранов и систем обнаружения вторжений
- предоставляет защиту от веб-атак: SQL-инъекций, межсайтового скриптинга, небезопасных конфигураций и т. д.
- определяет и блокирует уязвимости веб-приложений — «виртуальный патчинг»

**Honeypot (приманка, ловушка)** — система, предназначенная для обнаружения компьютерных атак через имитацию работы реальной системы

**Honeypot: типы**
- Полная эмуляция системы (Pure honeypot)
- Высокоинтерактивные (High-interaction honeypot)
- Низкоинтерактивные (Low-interaction honeypot)

**Honeypot: недостатки**
- Если ловушка плохо настроена, её легко распознать
- Ловушка может обнаружить только атаку на саму ловушку
- Если ловушка распознана, на неё можно совершить «атаку», чтобы отвлечь от реальных действий в системе
- Если ловушка содержит уязвимости, через неё можно атаковать систему

# Лучшие практики современной информационной безопасности
 
Современная информационная безопасность (ИБ) — это комплекс мероприятий, направленный на защиту информации от угроз и опасности несанкционированного доступа, использования, раскрытия, изменения, порчи или уничтожения. Сегодня ИБ стала особенно важной из-за роста объёмов и значимости информации, которая хранится и обрабатывается в компьютерных системах. Это касается как государственных структур, так и частных компаний и организаций. Современные угрозы включают в себя киберпреступность, шпионаж, хакерские атаки, вирусы и многие другие формы злоумышленного поведения. Для защиты информации используются различные методы, включая шифрование, контроль доступа, мониторинг и обнаружение инцидентов, а также обучение персонала и проведение аудитов. Однако, как и сама технология, угрозы постоянно меняются и усложняются, поэтому вопросы ИБ должны оставаться приоритетными для всех, кто работает с компьютерной информацией.

**SIEM**

Давайте поговорим о том, как SIEM-системы помогают защищать данные и инфраструктуру организации от различных угроз.

SIEM-системы играют важную роль в обеспечении безопасности в сложных IT-средах, обрабатывая большие объёмы данных и выявляя потенциальные угрозы, которые могут пройти незамеченными другими системами безопасности. Мы рассмотрим основные концепции SIEM, а также функциональные возможности и преимущества при использовании этих систем.

**SIEM (Security Information and Event Management)**
- технология, обеспечивающая анализ в реальном времени событий безопасности элементов информационной системы;
- процесс, объединяющий активность внутри информационной системы в единый набор данных.

**Основная функция SIEM** заключается в том, чтобы предотвращать и обнаруживать атаки на информационную систему или сеть. Для этого система собирает информацию о событиях безопасности, таких как неудачные попытки входа в систему, подозрительные активности пользователей и другие подобные события. С помощью анализа данных, собранных SIEM, становится возможным выявить нежелательные или вредоносные активности и принять меры по защите системы. Кроме того, SIEM может быть использована для сбора и хранения информации о событиях безопасности для последующего анализа и улучшения стратегии безопасности. SIEM может быть использована в различных сферах, включая IT-безопасность, финансы, здравоохранение, государственное управление и другие. Она является одним из наиболее важных инструментов для обеспечения безопасности информационных систем и сетей в условиях постоянно увеличивающихся рисков и угроз.

**Основные задачи, решаемые с помощью SIEM:**
- сбор, обработка и анализ событий безопасности в режиме реального времени — логи, трафик;
- обнаружение атак — события, корреляции;
- оценка защищённости ресурсов — данные аудита;
- анализ и управление рисками безопасности (активы);
- проведение расследований инцидентов;
- принятие решений по защите информации;
- формирование отчётных документов.

**Работа SIEM основана на правилах корреляции.** Это согласованные правила, которые используются SIEM-системами для связывания нескольких событий и анализа их как одного целого. Такие правила позволяют выявлять сложные угрозы, которые могут быть незаметны, если анализировать каждое событие отдельно. Правило корреляции может определять, что одинаковый IP-адрес отправил большой поток трафика на сервер базы данных, а затем была произведена попытка входа в систему с этого же IP-адреса. Если рассматривать эти два события по отдельности, то они могут казаться нормальными. Но если их рассматривать вместе, они могут указывать на целевую атаку или нарушение безопасности.

**Для создания правил корреляции SIEM-системы используют:**
- алгоритмы машинного обучения;
- статистические методы;
- другие инструменты для анализа больших объёмов данных из различных источников событий, таких как системы препятствия взлому, системы обнаружения вторжений, логи приложений и операционных систем, базы данных и другие.

Правила корреляции также могут быть настроены для специфических технологий или типов угроз. Например, правило корреляции может быть создано для обнаружения атак с использованием вредоносного ПО, таких как троянские кони или ботнеты, либо для детектирования атак на промышленные протоколы в АСУ ТП.

Если SIEM обнаруживает события, которые соответствуют этому правилу, она генерирует оповещение, чтобы специалисты информационной безопасности могли принять меры по предотвращению возможной угрозы.

**Примеры правил корреляций**
- Обнаружение вредоносного ПО, использующего DNS-туннелирование. Правило анализирует данные из логов DNS-серверов и фаерволов. Если система обнаруживает необычную активность, такую как большое количество запросов к определённому домену или большие по объёму запросы, то это может указывать на использование DNS-туннелирования вредоносным ПО.
- Обнаружение атаки на учётные записи. Если система обнаруживает подозрительную активность, такую как попытки входа в систему с разных IP-адресов с использованием одной учётной записи или попытки входа в систему с неправильными учётными данными, то это может указывать на атаку на учётную запись.

Чтобы правила корреляций могли эффективно обнаруживать атаки, должен быть обеспечен сбор информации с большого количества узлов защищаемой системы, в идеале — все устройства сети должны передавать всю информацию о безопасности в SIEM.

**Примерный перечень источников для сбора информации:**
- данные аутентификации;
- DLP;
- IDS/IPS;
- антивирусы;
- журналы событий и логи;
- межсетевые экраны;
- активное сетевое оборудование;
- сканеры уязвимостей;
- системы инвентаризации.

**К недостаткам SIEM можно отнести:**
- сложность настройки — настройка SIEM-систем может быть сложной задачей, особенно для небольших организаций, не имеющих достаточного количества специалистов по информационной безопасности;
- ложноположительные срабатывания — SIEM-системы могут приводить к большому количеству ложных срабатываний, которые требуют дополнительных ресурсов для анализа и подтверждения подлинности угрозы;
- количество данных — объёмы данных, которые генерируются при использовании SIEM, могут быть огромными. Обработка этой информации может требовать значительных ресурсов и вычислительной мощности;
- стоимость — системы SIEM могут быть дорогими как в плане лицензирования, так и в плане технического обслуживания и поддержки (примерно $3 000 – 10 000 в год для организации в 100 человек в зависимости от типа лицензии);
- необходимость интеграции — системы SIEM нуждаются в интеграции с другими системами безопасности, такими как IDS/IPS (системы обнаружения и предотвращения вторжений) или DLP (системы защиты от утечки данных), чтобы обеспечить полный контроль над безопасностью информации;
- сложность анализа — анализ данных, которые генерируются SIEM-системами, может быть очень сложным. Это требует высокой квалификации специалистов по безопасности информации и использования специальных инструментов для работы с большим объёмом данных;
- ограничения по типам угроз — некоторые виды угроз трудно обнаружить даже с помощью SIEM. Например, угрозы, связанные с социальной инженерией.

**SOC**

**SOC (Security Operation Center)** — центральный пункт для мониторинга и управления информационной безопасностью организации. SOC обеспечивает сбор, анализ и реагирование на угрозы безопасности, которые могут возникнуть в корпоративных сетях.

В идеале SOC должен решать абсолютно весь спектр задач, связанных с ИБ внутри компании:
- обеспечение безопасности и защиты ценных активов организации;
- мониторинг событий безопасности в реальном времени (SIEM);
- анализ данных для выявления угроз — сканеры безопасности;
- реагирование на инциденты безопасности — forensic tools;
- восстановление после инцидента;
- предоставление отчётности о произошедших событиях.
 
Существует несколько видов Security Operation Center (SOC), каждый из которых имеет свои особенности и направлен на решение определённых задач
- In-house SOC — центр безопасности, который находится внутри компании и управляется её собственными безопасниками. Такой SOC может быть создан для обеспечения безопасности конкретной службы или всей организации.
- Co-managed SOC — это SOC, который управляется сторонней компанией. Заказчик сохраняет контроль над операциями безопасности, но обслуживающая компания предоставляет персонал и инфраструктуру для выполнения этих операций.
- Fully-managed SOC — SOC, который полностью управляется сторонней компанией. Заказчик выносит все операции, связанные с ИБ, в такую компанию, которая предоставляет персонал, инструменты и инфраструктуру для выполнения операций по обеспечению кибербезопасности.
- Virtual SOC — SOC, который работает виртуально, без физического центра безопасности. Такой SOC может быть настроен для мониторинга и управления безопасностью в облаке.
- Hybrid SOC — SOC, который комбинирует несколько подходов к безопасности и может включать в себя элементы каждого из вышеуказанных типов SOC.

Современный SOC представляет собой команду и набор технологических компонентов, которые обеспечивают мониторинг, анализ, реагирование и управление безопасностью информационных систем.

**Рассмотрим подробнее каждый из компонентов SOC**
- Системы мониторинга — это основа работы SOC. Они позволяют наблюдать за поведением информационной системы в режиме реального времени и выявлять отклонения от нормы. Системы мониторинга могут включать в себя различные инструменты: системы логирования, системы мониторинга сетевого трафика, системы детектирования угроз, и, естественно, SIEM.
- Аналитические инструменты используются для анализа полученных данных и выявления потенциальных угроз. Это может быть как ручной анализ событий, так и автоматический анализ с помощью машинного обучения и искусственного интеллекта.
- Специалисты кибербезопасности — это в первую очередь персонал, в задачи которого входит обнаружение, анализ и оперативное реагирование на инциденты кибербезопасности. Такие специалисты могут иметь различные роли и задачи:
  - аналитики безопасности отслеживают потенциальные угрозы,
  - инженеры безопасности настраивают системы мониторинга,
  - инцидент-менеджеры координируют действия по реагированию на инциденты безопасности.
- Процедуры реагирования на инциденты — это набор процедур, определённых заранее, которые должны быть выполнены при возникновении инцидента безопасности. Эти процедуры включают в себя такие действия как: изоляция уязвимостей, блокировка IP-адресов, изменение конфигураций систем и другие действия по предотвращению распространения угроз.
- Управление информационной безопасностью — компонент SOC, который отвечает за планирование, организацию и контроль деятельности по обеспечению безопасности информационных систем организации.

Именно взаимодействие всех этих компонентов позволяет SOC эффективно работать для защиты информационных систем от различных угроз.

**Примеры успешной практики работы SOC в различных отраслях и компаниях**
- Крупная телекоммуникационная компания реализовала систему SOC для защиты своих сетей и клиентских данных. Система SOC использует средства мониторинга и анализа, а также средства защиты периметра, чтобы обеспечить безопасность сети. Результатом явилось сокращение числа инцидентов информационной безопасности и уменьшение времени, затраченного на диагностику и ликвидацию инцидентов.
- Одна из крупнейших фармацевтических компаний создала свой SOC, который работает в тесном сотрудничестве с другими функциональными подразделениями компании. Команда SOC использует различные средства мониторинга и анализа данных для обнаружения угроз информационной безопасности. Они также работают над проведением регулярных тестов на проникновение и разработкой стратегий реагирования на инциденты. Результатом явилось улучшение безопасности данных и сохранение репутации компании.
- Одна из крупнейших авиакомпаний в мире создала свой SOC для защиты своих систем, которые обслуживают десятки тысяч пассажиров каждый день. Команда SOC использует систему мониторинга и анализа данных, чтобы обнаруживать угрозы информационной безопасности раньше, чем они станут серьёзными проблемами. Результатом явилось сокращение числа инцидентов информационной безопасности и минимизация воздействия на работу авиалиний.

**DMZ**

Безопасность при работе с интернетом — одна из самых актуальных проблем. Ведь в этом случае мы рассматриваем не только угрозы, которые могут происходить от злоумышленников, но и проблемы с удалёнными сотрудниками или необходимость предоставить доступ к сетевым службам компании для удалённых пользователей. В этом контексте особенно важным становится понятие DMZ (демилитаризованной зоны), которая позволяет обеспечить безопасность сети компании и одновременно с этим предоставить доступ к необходимым сетевым службам.

**DMZ (демилитаризованная зона)** — отдельный сетевой сегмент, в котором размещены сервисы, публикуемые в интернете.

DMZ позволяет организовать защиту внутренней сети компании, перенаправляя входящие запросы к серверам, находящимся в DMZ, через специально настроенный маршрутизатор или брандмауэр, который фильтрует трафик и блокирует попытки неавторизованного доступа.

**Задачи, которые решает DMZ:**
- уменьшение трафика внутренней сети, связанного с обработкой запросов из интернета;
- обеспечение безопасности внутренней сети компании путём предоставления только необходимых сервисов в DMZ;
- защита серверов, находящихся в DMZ, от атак из интернета путём использования специальных механизмов безопасности, например, брандмауэров или IDS.

Если позволяет бюджет, имеет смысл на стыках интернет-DMZ и DMZ-сети компании устанавливать межсетевые экраны разных производителей. Однако современные маршрутизаторы и межсетевые экраны позволяют создавать DMZ, используя одно устройство.

**Защита инфраструктуры компании**

В наше время, когда всё больше компаний переходят на цифровые платформы и привлекают всё больше клиентов через интернет, безопасность становится особенно важной. Хакерские атаки на корпорации, утечки конфиденциальных данных и другие киберугрозы могут стать серьёзным испытанием для любой компании, независимо от её размера или отрасли. В этом занятии мы рассмотрим лучшие практики кибербезопасности, которые помогут защитить вашу компанию от угроз и минимизировать риск возникновения инцидентов. Мы изучим стратегии и методы, которые помогают разработать эффективную политику безопасности, защитить сеть и данные компании, а также обучить персонал правилам информационной безопасности.
 
**Современная защита сети компании должна включать в себя ряд обязательных мероприятий.**

- Использование многоуровневой защиты — защита должна быть построена на нескольких уровнях, включая:
  - защиту периметра;
  - сегментирование сети;
  - защиту оконечного (endpoint) оборудования.
- Регулярное обновление программного обеспечения — важно следить за обновлениями ПО в рамках всей сети, включая операционные системы, приложения и антивирусное ПО. Необходимо установить автоматическое обновление для всех компонентов системы.
- Сильные пароли и двухфакторная аутентификация — для защиты от несанкционированного доступа к сети следует использовать сложные пароли или двухфакторную аутентификацию. Рекомендуется использовать уникальные пароли для каждой учётной записи или сетевой службы и не хранить их в открытом виде на рабочем месте.
- Организация контроля доступа — доступ к различным ресурсам сети должен быть организован на основе принципов минимальных привилегий. То есть каждый пользователь должен иметь доступ только к тем ресурсам, которые необходимы для выполнения его задач.
- Мониторинг сетевой активности — необходимо регулярно отслеживать сетевую активность для выявления аномальных событий и вредоносной активности. Для этого можно использовать системы обнаружения вторжений (IDS) или системы обнаружения аномалий (ADS).
- Защита от вредоносных программ — следует использовать антивирусное ПО и другие технологии защиты от вредоносных программ для защиты от атак через электронную почту, веб-браузеры, уязвимости ОС и т. п.
- Организация обучения пользователей — важно обучать пользователей основным правилам безопасности, чтобы они становились активными участниками процесса кибербезопасности.
- Резервное копирование данных — необходимо регулярно создавать резервные копии данных пользователей и конфигураций серверного и сетевого оборудования, хранить их в надежном месте и проверять их работоспособность.
- Tестирование системы безопасности — регулярно проводите тестирование системы безопасности на наличие уязвимостей.
- Организация реагирования на инциденты — необходимо иметь план действий для реагирования на инциденты безопасности. План должен включать процедуры оповещения, анализа ситуации и ликвидации последствий.

Эти практики являются основой современной кибербезопасности и позволяют обеспечить высокий уровень защиты от различных видов угроз.

Если мы рассматриваем защиту сети компании, то следует начинать с разделения сети на отдельные сегменты — сегментации сети. 

**Сегментация сетей** — это процесс разбиения компьютерной сети на несколько отдельных сегментов, каждый из которых имеет свои заданные ограничения доступа. Основная цель сегментации сетей заключается в том, чтобы защитить отдельные сегменты от внешних атак и злоумышленников, а также предотвратить распространение вирусов и других вредоносных программ от одного сегмента к другому.

**Принципы сегментации сетей**
- Разбивка на подсети. Сеть разбивается на несколько подсетей, каждая из которых имеет свой уникальный IP-адрес. Каждая подсеть может быть настроена с различными параметрами безопасности и доступа к ресурсам.
- Использование маршрутизаторов. Для обеспечения связи между различными сегментами используются маршрутизаторы. Маршрутизаторы контролируют передачу данных между сегментами и позволяют настраивать правила безопасности и доступа к ресурсам.
- Фильтрация трафика. Каждый маршрутизатор может быть настроен на фильтрацию трафика, что позволяет контролировать входящий и исходящий трафик между сегментами. Маршрутизаторы также могут блокировать определённые порты и протоколы.
- Использование брандмауэров. Для дополнительной защиты каждого отдельного сегмента может быть использован брандмауэр. Брандмауэры контролируют доступ к ресурсам и блокируют нежелательный трафик, что повышает уровень безопасности сети.
- Разделение прав доступа. Каждый сегмент может быть настроен со своими собственными правами доступа и политиками безопасности. Это позволяет контролировать доступ к конкретным ресурсам и ограничивать возможности пользователей в каждом сегменте.
- Мониторинг и анализ трафика. Для обнаружения потенциальных угроз безопасности сети необходимо осуществлять постоянный мониторинг и анализ трафика в каждом сегменте. Это позволяет оперативно реагировать на любые аномалии и предотвращать возможные атаки.

Применение этих принципов сегментации сетей позволяет повысить уровень безопасности компьютерной сети, предотвратить распространение вирусов и других вредоносных программ, а также контролировать доступ к ресурсам и ограничивать возможности пользователей.
 
Если компания относится к тому или иному сектору промышленности, то может потребоваться интеграция офисной сети и АСУ ТП — Автоматизированная Система Управления Технологическим Процессом. В этом случае на границе офисной и промышленной сети обязательно должна быть своя DMZ.Защита самой АСУ ТП обычно строится по регламентам соответствующей отрасли промышленности: энергетика, нефтегаз, металлургия и т. п. В ней применяются специфические IDS и межсетевые экраны, понимающие промышленные протоколы передачи данных.Также следует учитывать, что АСУ ТП может иметь собственные точки выхода в глобальные сети, например, для систем коммерческого учёта. В этом случае необходимо защищать эти каналы связи с помощью дополнительного оборудования, либо средствами, предоставляемыми провайдерами связи.

Следует отдельно поговорить о защите систем виртуализации. Виртуализация помогает ускорить развёртывание и оптимизировать ресурсы, но в то же время создаёт новые уязвимости для злоумышленников.

Если мы рассмотрим жизненный путь контейнера или виртуальной машины, то можно выделить три большие стадии.
- Build — создание образа.
- Ship — доставка образа.
- Run — запуск, работа образа.

**Для защиты контейнеров в Linux можно использовать несколько методов.**
- Использование утилиты AppArmor или SELinux для управления правами доступа контейнеров к ресурсам системы. Это поможет предотвратить несанкционированный доступ контейнеров к системным ресурсам и уменьшить риск атак.
- Использование сетевых инструментов iptables или nftables для ограничения доступа к сетевым ресурсам контейнеров или настройки специальных сетей для установки контейнеров. Это может помочь предотвратить распространение атак на другие контейнеры или хостовую систему.
- Контроль цифровых подписей для контейнеров. Это позволяет проверить подлинность контейнера и убедиться, что он не был изменён или заменён злоумышленником. Для этой цели можно использовать инструменты Docker Content Trust или Notary.
- Использование инструментов мониторинга Docker для обнаружения необычной активности в контейнерах — Sysdig или Prometheus. Это поможет обнаружить аномальную активность, такую как повышенный трафик или попытки вторжения.
- Использование специальных расширений ядра Linux Kernel Same-page Merging (KSM) и User Namespace, которые помогают уменьшить возможности для атак.

Обеспечение безопасности контейнеров — это сложная и постоянно меняющаяся задача, и защита должна основываться на анализе конкретного применения и настройке соответствующих инструментов для защиты контейнеров в зависимости от их специфических потребностей в безопасности.
 
**Рассмотрим примерный план использования AppArmor для защиты виртуализации**
Установите AppArmor на хосте и внутри гостевой операционной системы. На большинстве дистрибутивов Linux, чтобы установить AppArmor, выполните следующую команду:
```
sudo apt install apparmor-utils
```
Создайте конфигурационный файл AppArmor для виртуальной машины. Для этого выполните следующую команду:
```
sudo aa-genprof <virtual_machine_name>
```
При выполнении этой команды AppArmor автоматически создаст конфигурационный файл профиля для виртуальной машины и запустит её.

Выполните сбор информации о доступе, во время использования виртуальной машины и создайте соответствующий профиль.
```
sudo aa-logprof <virtual_machine_name>
```
При выполнении этой команды AppArmor запустит виртуальную машину и затем начнёт запись информации о доступе. Затем AppArmor автоматически создаст профиль для виртуальной машины на основе этой информации.

Настройте исполняемые файлы приложения, которые используются виртуальной машиной, в соответствии с профилем AppArmor. Например, если виртуальная машина запускает Apache, необходимо добавить следующее в профиль, чтобы разрешить доступ к каталогу var/www/html:
```
/var/www/html/ rw
```
Если виртуальная машина использует базу данных MySQL, то необходимо добавить следующую строку:
```
/var/lib/mysql/ r
```
После настройки профиля AppArmor для виртуальной машины выполните команду:
```
sudo service apparmor restart
```
Это перезапустит AppArmor на хосте и настроенный профиль будет автоматически активирован. Если приложение, запущенное в виртуальной машине, попытается получить доступ к файлам или ресурсам, которые не указаны в профиле, AppArmor блокирует этот доступ.

# DevSecOps

**DevSecOps** – практика разработки программного обеспечения, которая объединяет в себе процессы разработки, безопасности и операционной деятельности. Это новый подход к разработке, который помогает компаниям создавать более безопасные и надежные продукты, ускорять доставку функциональности и улучшать качество кода. В рамках этой части лекции мы рассмотрим основные принципы DevSecOps, инструменты и методологии, а также практические примеры его применения.

**DevOps** — методология, обеспечивающая взаимодействие разработчиков и системных администраторов на всех этапах SDLC.

**DevSecOps (Development, Security, Operations)** — интеграция проверки безопасности на всех этапах жизненного цикла разработки программного обеспечения.

**Основные принципы DevSecOps включают:**
- раннее вовлечение безопасности – в DevSecOps безопасность должна быть встроена в самые ранние этапы разработки. Это может включать анализ уязвимостей кода и требований к безопасности еще на стадии планирования проекта;
- автоматизация безопасности – в DevSecOps используются автоматические инструменты для проверки безопасности. Это позволяет снизить риски ошибок, связанных с человеческим фактором, и обеспечить более быстрое выявление уязвимостей;
- стратегия непрерывной безопасности – DevSecOps предполагает постоянный мониторинг и управление безопасностью приложений. Это может включать создание систем мониторинга, которые будут следить за безопасностью приложения в реальном времени;
- культура безопасности – DevSecOps подразумевает создание культуры безопасности в организации, которая должна быть прочно встроена в корпоративную культуру. Это может включать обучение сотрудников по вопросам безопасности и поощрение лучших практик безопасности при разработке приложений;
- сотрудничество – DevSecOps предполагает сотрудничество между отделами разработки, тестирования, эксплуатации и безопасности. Различные члены команды должны работать вместе, чтобы обеспечить безопасность приложений на всех этапах их жизненного цикла.

Кроме DevSecOps важно понимать, как происходит разработка программного обеспечения, чтобы в дальнейшем правильно соотносить этапы, специалистов и используемые инструмент. Т.к. разработка коммерческого продукта циклична, то для её описания существует специальный обобщающий термин – SDLC.

**SDLC (Software Development Life Cycle, жизненный цикл разработки ПО)** — замкнутый жизненный цикл ПО, разбитый на определённые этапы. SDLC представляет собой методологию, которая помогает разработчикам и другим участникам проекта управлять и контролировать каждый этап создания программного продукта.

**В основе SDLC лежит следующая последовательность шагов:**
- Планирование – на этом этапе определяются требования к программному продукту, оценивается его сложность, распределяются ресурсы и составляется план работ;
- Анализ – на этом этапе проводится более детальный анализ требований к программному продукту, формируются функциональные и нефункциональные требования, определяется структура баз данных и т.д.;
- Проектирование – на этом этапе создается общий план системы и ее компонентов. Разрабатывается архитектура приложения, составляются спецификации интерфейса, проектируются базы данных, определяется язык программирования и т.д.;
- Разработка – на этом этапе происходит создание кода и прототипов компонентов системы;
- Tестирование – на этом этапе тестируются все компоненты системы. Здесь проводятся модульные тесты, интеграционные тесты, системные тесты, а также тестирование производительности и безопасности;
- Развертывание – на этом этапе система устанавливается в окружение пользователя;
- Поддержка – на этом этапе система поддерживается, обновляется и модифицируется.

SDLC представляет собой итеративный процесс, который может повторяться несколько раз до достижения желаемых результатов. Каждый этап SDLC имеет свои цели и задачи, которые должны быть выполнены, чтобы перейти к следующему этапу. Основная цель SDLC – добиться максимальной эффективности и эффективности всего процесса создания программного продукта.

**Ключевые инструменты DevSecOps включают в себя:**
- системы управления версиями – Git, SVN или Mercurial, позволяют команде быстро отслеживать изменения в коде, сохранять их и возвращаться к предыдущим версиям при необходимости;
- системы непрерывной интеграции и доставки (Continuous Integration/Continuous Delivery, CI/CD) – Jenkins, Travis CI и CircleCI, автоматизируют процесс сборки, тестирования и доставки приложений в продуктивную среду;
- анализаторы кода – SonarQube, ESLint и PMD, позволяют проводить статический анализ кода, выявлять потенциальные проблемы безопасности и другие ошибки, и предоставляют рекомендации по их исправлению;
- инструменты тестирования безопасности – Burp Suite, OWASP ZAP и Acunetix, позволяют проводить динамический анализ кода и тестирование на уязвимости, чтобы обнаруживать и исправлять проблемы безопасности приложений;
- инструменты мониторинга безопасности – Nagios, Prometheus и ELK Stack, предоставляют информацию о состоянии инфраструктуры и приложений в реальном времени, позволяя оперативно реагировать на любые угрозы или отклонения от стандартов безопасности.

Каждый из этих инструментов может быть использован на различных этапах процесса разработки приложений, начиная от управления кодом и сборки, заканчивая мониторингом и защитой в продуктивной среде. Использование этих инструментов помогает повысить качество приложений, обеспечить безопасность и ускорить процесс доставки ПО.

**Кратко охарактеризуем практическое применения DevSecOps:**
- интеграция инструментов безопасности – одной из ключевых задач DevSecOps является интеграция инструментов безопасности в CI/CD-пайплайн. Например, можно использовать инструменты для сканирования кода на предмет уязвимостей, а также для тестирования на проникновение в приложение;
- автоматизация тестирования безопасности – автоматическое тестирование на проникновение, тестирование на отказы и другие методы тестирования;
- обучение разработчиков – разработчикам и системным администраторам нужно быть в курсе последних тенденций в области безопасности, а также уметь применять соответствующие методы и инструменты;
- контейнеризация – использование контейнеров позволяет повысить безопасность приложения путем создания изолированной среды выполнения;
- мониторинг безопасности – мониторинг журналов системных сообщений, мониторинг событий безопасности и другие методы мониторинга.

**В целом, DevSecOps** – это подход, который объединяет разработку, безопасность и операции для создания более безопасного процесса разработки ПО. Результатом являются более безопасные приложения, готовые к быстрой и эффективной поставке заказчикам.
