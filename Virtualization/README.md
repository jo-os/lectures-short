# Виртуализация и облачные решения

Облачная инфраструктура - это тоже ЦOД, но виртуальный, предлагается, как услуга, и используется через интернет

Основные компоненты:
- серверы
- системы хранения данных
- вычислительные ресурсы
- система безопасности

**Виды облаков**

**Публичное облако (англ. Public cloud)** — инфраструктура, предназначенная для свободного использования широкой публикой
- Публичное облако может находиться в собственности, управлении и эксплуатации коммерческих, научных и правительственных организаций или их комбинации
- Публичное облако физически существует в юрисдикции владельца — поставщика услуг

**Частное облако** — объединяет в себе службы облачных вычислений, предоставляемые по интернету или по частной внутренней сети не всем, а только определённым пользователям
- Преимущество частного облака — высокая безопасность
- Недостаток — ИТ-отдел компании несёт ответственность за стоимость и подотчётность, касающиеся управления частным облаком

**Общественное облако** — вид инфраструктуры, которая распределяется между несколькими организациями из определённого сообщества с общими интересами
- Может находиться в совместной собственности, управлении и эксплуатации этих организаций или третьей стороны
- Может физически существовать как внутри, так и вне юрисдикции владельца

**Гибридное облако** — вычислительная система, в которой используются все разновидности виртуальных сред. Добавление в инфраструктуру традиционных ИТ-ресурсов позволяет построить гибридную ИТ-модель, которая обладает преимуществами:
- цены общедоступного облака
- общая гибкость облачных вычислений
- безопасность выделенного оборудования

Основные виды услуг в облаке
- Infrastructure-as-a-Service (IaaS) — инфраструктура как услуга
- Platform-as-a-Service (PaaS )— платформа как услуга
- Software-as-a-Service (SaaS) — ПО как услуга

**Инфраструктура как услуга (IaaS)** — модель обслуживания в облаке, в которой потребителям предоставляются по подписке виртуальные серверы с заданной вычислительной мощностью и операционной системой

**Платформа как услуга (PaaS)** — модель предоставления облачных вычислений, при которой потребитель получает доступ к использованию информационно-технологических платформ: операционных систем, систем управления базами данных и другим программам

**ПО как услуга (SaaS)** — одна из форм облачных вычислений, при которой подписчикам предоставляется готовое прикладное программное обеспечение, полностью обслуживаемое провайдером

**Amazon Web Services (AWS With EC2)** — самая современная реализация систем управления виртуализацией. Гипервизоры и прочая реализация системы скрыты от пользователя, при этом есть гарантированные показатели доступности и отказоустойчивости

Пользователь может создавать инфраструктуру продуктивных окружений и использовать преимущества:
- установка в нескольких локациях
- построение цепочки с другими сервисами облака
- программное API для автоматизации создания и изменения ресурсов

**OpenStack** — комплекс проектов свободного ПО, который может быть использован для создания инфраструктурных облачных сервисов и облачных хранилищ, как публичных, так и частных

**Google Сloud Platform** - комплекс облачных сервисов для организаций и технических специалистов

Инфраструктурные сервисы позволяют обеспечить проект основными ресурсами:
- наладить обработку и хранение данных
- безопасный доступ и обмен трафиком

**Google Compute Engine** — это сервис аренды вычислительных сред в публичном облаке (IaaS) на базе ОС Linux, предоставляющий услуги на базе платы за почасовое потребление ресурсов — вычислительные мощности и хранилища

**Yandex Cloud** — облачная платформа, предоставляющая пользователям в формате «as a service»:
- инфраструктурные сервисы — Yandex Compute Cloud, Yandex Object Storage, Yandex Message Queue, Yandex Virtual Private Cloud и Yandex Identity and Access Management
- платформенные сервисы — Yandex Managed Service (для различных баз данных), Yandex SpeechKit и Yandex Translate

# Types of virtualizations

**Виртуализация** — это создание изолированных окружений в рамках одного физического устройства. Каждое окружение выглядит, как отдельный компьютер со своими характеристиками (доступная память, процессор и тп.) 

Такое окружение называют набором **логических ресурсов** или **виртуальной машиной**.

ОС, внутри которой стартует другая ОС, называется **хост-системой, (host)**. А ОС, которая работает в виртуальном окружении — **гостевой (guest)**.

**Виртуализация бывает:**
- Аппаратная
- Программная
- Контейнерная (будет рассмотрена в следующих лекциях)
- Хостинговая (рассматривалась на первой лекции)

**Аппаратная виртуализация** работает благодаря поддержке со стороны железа: процессора. В отличие от программной виртуализации, гостевые ОС управляются гипервизором напрямую, без участия хостовой ОС.
- + Работает без посредников, быстро, весело, надежно.
- - Привязана к платформе: нет технологии — нет виртуализации.

**Программная виртуализация** эмулирует все железо от процессора до сетевого адаптера (если он нужен). В отличие от аппаратной виртуализации, не важно, какое у вас аппаратное обеспечение, будет работать на любом железе.
- + Хост система и гостевая система не зависимы.
- - Медленная, так как надо эмулировать все, что работает быстро.

**История создания**
- Первая аппаратная виртуализация Intel была воплощена в 386-х процессорах и носила название **V86 mode**.  Этот режим работы 8086-го процессора позволял запускать параллельно несколько DOS-приложений
- Второе, что было реализовано — **многозадачность**. Она является первым уровнем абстракции приложений. Каждое приложение распределяет ресурсы физического процессора в режиме разделения исполнения кода по времени.
- **HyperThreading** представляет собой аппаратную технологию виртуализации: при ее использовании происходит симуляция двух виртуальных процессоров в рамках одного физического с помощью техники Symmetric Multi Processing (SMP).
- Процессор с поддержкой виртуализации может работать в двух режимах **root operation** и **non-root operation**. В режиме root operation работает специальное программное обеспечение, являющееся «легковесной» прослойкой между гостевыми операционными системами и оборудованием — монитор виртуальных машин (Virtual Machine Monitor, VMM), носящий также название гипервизор **(hypervisor)**.

Технологии аппаратной виртуализации
- Intel — VT-x VT-d VMDQ
- AMD — AMD-V
- ARM Limited — EL2

**AMD** - Аппаратная виртуализация — это логическое развитие архитектуры AMD Direct Connect, реализующая технологию виртуализации в кремнии. Эта технология дает больше возможностей производителям программного обеспечения, позволяя не беспокоиться о программной эмуляции виртуализации на процессоре.

Аппаратная виртуализация AMD реализуется путем введения новых режимов работы процессора и дополнительных инструкций:
- Новый режим процессора: Guest Mode
- Новая структура данных: Virtual Machine Control Block (VMCB)
- Новая инструкция: VMRUN
- Новый режим памяти: Real Mode w/ Paging

**Intel** - Аппаратная виртуализация VT-x описывается специальной структурой VMCS (Virtual Machine Control Structure) и является небольшим участком физической оперативной памяти, хранящим:
- минимально необходимые данные для запуска гостевой ОС,
- данные, необходимые для безопасного выхода из режима работы гостевой ОС,
- некоторые настройки, относящиеся к управлению этой виртуальной машиной.

**ARM** гипервизор работает с уровнем исключения EL2. Только программное обеспечение, работающее на уровне исключения EL2 или выше, может получить доступ и настроить различные функции виртуализации.

**KVM** - Для исполнения прямых аппаратных запросов в ОС должна иметься библиотека, которая направляла бы эти запросы аппаратной части напрямую. Red hat создала ассоциацию Open Virtualization Alliance, которая была признана решить проблему отсутствия базового гипервизора для ядра Linux. Так и был создан гипервизор KVM или Kernel-based Virtual Machine.

**Принцип KVM** - Гипервизор KVM представляет из себя загружаемый модуль ядра Linux, который предназначен для обеспечения виртуализации на платформе Linux x86. Сам модуль содержит:
- компонент собственно виртуализации (kvm.ko),
- процессорно-специфический загружаемый модуль kvm-amd.ko либо kvm-intel.ko

- Начиная с версии ядра 2.6.20, KVM является основной составляющей Linux. Иными словами, если у вас стоит Linux, то у вас уже есть KVM.
- Необходимым условием для использования KVM является поддержка одной из инструкций виртуализации — Intel VT-x, AMD-V или ARP с поддержкой EL2
- Сам по себе KVM не выполняет эмуляции. Вместо этого программа, работающая в пространстве пользователя, использует интерфейс /dev/kvm для настройки адресного пространства гостя виртуальной машины, через него же эмулирует устройства ввода-вывода и видеоадаптер.
- KVM позволяет виртуальным машинам использовать немодифицированные образы дисков QEMU, VMware и других, содержащие ОС.
- Каждая виртуальная машина имеет свое собственное виртуальное аппаратное обеспечение: сетевые карты, диск, видеокарту и другие устройства

**libvirt** — это набор инструментов, предоставляющий единый API к множеству различных технологий виртуализации.

При использовании libvirt не важно какой «бекенд»: Xen, KVM, VirtualBox или что-то ещё. Более того, можно использовать libvirt внутри Ruby, Python, C++ и многих других программ или удаленно подключаться к виртуальным машинам по защищенным каналам.

**libvirt** — это просто API, а вот как с ним взаимодействовать решать пользователю.

**Xen** — кроссплатформенный гипервизор, разработанный в компьютерной лаборатории Кембриджского университета и распространяемый на условиях лицензии GPL.Основные особенности:
- поддержка режима паравиртуализации помимо аппаратной виртуализации,
- минимальность кода самого гипервизора, за счёт выноса максимального количества компонентов за пределы гипервизора.

**HYPER-V** система аппаратной виртуализации для x64-систем на основе гипервизора. Все они позволяют виртуализировать серверные платформы x86-64 и представляют собой системы аппаратной виртуализации для VPS хостинга и не только.

**QEMU** — свободная программа с открытым исходным кодом для эмуляции аппаратного обеспечения различных платформ. Включает в себя эмуляцию процессоров Intel x86 и устройств ввода-вывода. Может эмулировать 80386, 80486, Pentium, Pentium Pro, AMD64 и другие x86-совместимые процессоры; ARM, MIPS, RISC-V, PowerPC, SPARC, SPARC64 и частично m68k.

**Режимы QEMU**
- **Полная эмуляция системы** — полностью эмулирует устройство, включая все его компоненты, процессор и различные периферийные устройства. Он может использоваться для запуска нескольких ОС без перезагрузки или отладки системного кода.
- **Эмуляция пользовательского режима** — работает только для Linux хоста, позволяет запускать процессы Linux, скомпилированные для одной архитектуры в другой, например ARM программы в x86. Полезно для разработки, кросс- компиляции и отладки

Эмулятор qemu создает много команд, но их можно разделить на группы:
- qemu-архитектура — эмуляция окружения пользователя для указанной архитектуры;
- qemu-system-архитектура — эмуляция полной системы для архитектуры;
- qemu-img — утилита для работы с дисками;
- qemu-io — утилита для работы с вводом/выводом на диск;
- qemu-user — оболочка для qemu-архитектура, позволяет запускать программы других архитектур в этой системе;
- qemu-system — оболочка для qemu-system-архитектура, позволяет полностью эмулировать систему нужной архитектуры

Graphical Network Simulator (GNS3) — это графический симулятор сети, который позволяет смоделировать виртуальную сеть из маршрутизаторов и виртуальных машин. Незаменимый инструмент для обучения и тестов. Работает практически на всех платформах. Отлично подходит для создания стендов на десктоп машинах. В зависимости от аппаратной платформы, на которой будет использоваться GNS3, возможно построение комплексных проектов, состоящих из маршрутизаторов Cisco, Cisco ASA, Juniper, а также серверов под управлением сетевых операционных систем.
