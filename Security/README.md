# attacks
Уязвимости и атаки на информационные системы

**Исследование сетей**

Первым этапом любой атаки является исследование (exploration, разведка) атакуемой системы.

Основные задачи исследования сети:
- построение топологии сети;
- перечисление доступных сетевых узлов;
- обнаружение сетевых служб хостов.

Основные средства исследования сети:
- анализаторы пакетов (Wireshark);
- сканеры сети (nmap);
- сканеры уязвимостей (Nessus);
- средства создания пакетов (HPing).

**NMAP: возможности**
- обнаружение хостов в сети;
- обнаружение открытых портов хоста;
- определение сетевых служб хоста;
- сканирование диапазона IP-адресов (в том числе в сети Интернет);
- автоматизация поиска и дальнейшего исследования при помощи файлов сценариев (скриптов)

**NMAP: установка**

Nmap – стандарт средств сканирования сети, поэтому установлен по умолчанию в любой ОС, ориентированной на исследования в области безопасности.

Для самостоятельной установки нужно перейти на сайт - https://nmap.org

И в разделе загрузки (Download) выбрать версию для нужной ОС - https://nmap.org/download.html

**NMAP: основные режимы сканирования**
- -sS: TCP SYN-сканирование
- -sT: TCP connect-сканирование
- -sА: TCP FIN-сканирование
- -sU: UDP-сканирование
- -sX: Xmas-сканирование
- -PR: ARP-пинг
- --traceroute: трассировка пути
- -R: разрешение имен DNS
- -n: запрещение разрешения имен DNS
- -sL: создать список хостов
**NMAP: агрессивный режим сканирования** - Агрессивный режим сканирования (-A) – наиболее часто используемый режим сканирования. Предоставляет дополнительную информацию о хосте.

**NMAP: определение версий ПО на сервере** - nmap -sV scanme.nmap.org

**Hydra** – программа для подбора паролей.

Частичный список поддерживаемых протоколов: Cisco *, FTP, HTTP-FORM-GET, HTTP-FORM-POST, HTTP-GET, HTTP-HEAD, HTTP-POST, HTTP-PROXY, HTTPS-FORM-GET, HTTPS-FORM-POST, HTTPS-GET, HTTPS-HEAD, HTTPS-POST, ICQ, IMAP, IRC, LDAP, MS-SQL, MYSQL, Oracle *, PC-Anywhere, POP3, POSTGRES, RDP, Rlogin, SAP/R3, SIP, SMB, SMTP, SNMP, SOCKS5, SSH (v1, 2), SSHKEY, Teamspeak (TS2), Telnet, VNC. Домашняя страница: https://github.com/vanhauser-thc/thc-hydra

Выполним атаку на подбор пароля:
```
hydra -L users.txt -P pass.txt 192.168.0.5 ssh
```
**ARP-spoofing** – атака, использующая особенность протокола ARP, которая позволяет обработать ARP-ответ без предварительного ARP- запроса (протокол ARP не сохраняет свое состояние, stateless protocol). Данная атака позволяет злоумышленнику перехватывать трафик между узлами локальной сети и является разновидностью MITM-атак (Man In The Middle, человек посередине).

**MITM (Man In The Middle, человек посередине, атака посредника)** – атака, в результате которой атакующий скрытно принимает и передает информацию между двумя узлами. При этом атакуемые узлы считают, что общаются друг с другом напрямую

**DoS (Denial of Service, отказ в обслуживании)** – атака, направленная на исчерпание одного или нескольких ресурсов системы («перегрузка системы»). Результатом такой атаки является прекращение работы системы либо ее значительное замедление.

**DDoS (Distributed Denial of Service, распределенный по источникам отказ в обслуживании)** – вариант DoS-атаки, в котором целевая система атакуется сразу из множества источников. DDoS – атака, в результате которое большое количество сетевых узлов устраивает DoS-атаку на одну цель. Чаще всего для таких атак создаются ботнеты (сети из большого количества устройств под управлением атакующего)

**DDoS: реальные атаки**

В феврале 2020 года на Amazon Web Services была осуществлена одна из самых больших DDoS-атак за всю историю. Атака продолжалась три дня и в своем пике достигала трафика в 2,3 Тб/с 19 сентября 2016 года один из самых больших европейских хостинг- провайдеров OVH (примерно 18 million приложения для более чем миллиона клиентов) был атакован ботнетом Mirai состоящим из 145,000 узлов, генерирующим трафик до 1.1 Тб\с в течении семи дней

21 октября 2016 один из основных DNS-провайдеров Dyn был атакован тем же Mirai. В этой атаке трафик достига 1,5 Тб\с. В результате почти все службы Dyn оказались заблокированы, что отразилось на работе таких гигантов как GitHub, HBO, Twitter, Reddit, PayPal, Netflix и Airbnb.

28 февраля 2018 года был атакован GitHub. Трафик доходил до 1,35 Тб\с и длился примерно 20 минут. Несмотря на то что GitHub был готов к подобного рода атакам, против нагрузки подобного масштаба «устоять» не получилось.

**DoS: slow attack**

Slow attack – тип DoS-атак, при котором трафик, идущий на сервер, довольно маленький, т.е. не оказывает никакого влияния на канал связи. Особенностью этих атак является длительное время выполнения (slow).

Теперь предположим, что кто-то решил передавать приведенный выше запрос примерно по такой временной диаграмме:
- Connection: keep-alive
- <пауза 15 минут>
- Host: 127.0.0.1:8000
- <пауза 15 минут>
- Connection: keep-alive
- <пауза 15 минут>

Более того, даже один заголовок можно передавать аналогично:
- A
- <пауза 15 минут>
- с
- <пауза 15 минут>
- с
- <пауза 15 минут>
- e ... и т.д

**DoS: slow body**

Данный тип атаки аналогичен slow headers, только в этом случае медленно передается тело запроса (может быть любым):
- ...
- body = a...a...a...a...a...a...
- ...

**DoS: range attack (Apache killer)**

Производит манипуляции с HTTP-заголовком Range. Apache 1.3.x, 2.0.0-2.0.64, 2.2.0-2.2.19 (CVE-2011-3192: Apache range header handling vulnerability)

**DoS: slow read**

Медленное чтение – данная атака аналогична медленной записи, и использует особенности протоколов HTTP и TCP. На сервере выбирается большой ресурс и, манипулируя значением окна TCP (например, приравнивая его нулю), вызывается постоянное увеличение используемой памяти.

**Metasploit**

Metasploit – один из самых популярных фреймворков (framework) для тестирования на проникновение (пентест, pentest, penetration test)*. Metasploit имеет большое количество модулей, «связанных» собственной локальной БД, и развитое сообщество. *Тестирования на проникновение – легальная и согласованная эмуляция кибератаки на систему.

Metasploit появился в 2003 году, и в начале был реализован на Perl. Примерно в 2007 году был полностью переписан на Ruby и в 2009 году стал коммерческим проектом (после покупки проекта Rapid7).

Metasploit: возможности
- Сбор информации (Information Gathering, Enumeration)
- Получение доступа (Gaining Access)
- Повышение привилегий (Privilege Escalation)
- Расширение присутствия/доступа (Maintaining Access)
- Маскировка присутствия (Covering Tracks)

Metasploit: модули
- Auxiliaries (вспомогательные модули)
- Exploits
- Encoders (кодировщики)
- Payloads (полезная нагрузка)
- Post (пост эксплуатация)

# host-protection
Защита хоста

**Информационная безопасность**

**Информационная безопасность (Information Security, InfoSec)** — методы защиты информации путём уменьшения информационных рисков.

**Кибербезопасность (Computer security, cybersecurity)** — методы защиты компьютерных систем, их программного и аппаратного обеспечения, хранимых и передаваемых данных от компьютерных атак

- **Субъект** — пытается получить доступ к **объекту**
- **Объект** — то, к чему ограничивается или отслеживается **доступ**
- **Доступ** — операция чтения, записи, создания, удаления, модификации и т. д.

**ИБ: свойства информации**
- Конфиденциальность — состояние информации, при котором доступ к ней возможен только со стороны авторизованных на это субъектов.
- Доступность — возможность беспрепятственного доступа к информации для субъекта, имеющего необходимые права.
- Целостность — отсутствие неправомерного искажения, добавления, удаления информации.

**ИБ: угроза безопасности информации**
- Угроза безопасности информации — совокупность условий и факторов, создающих потенциальную или реально существующую опасность нарушения информационной безопасности (ГОСТ Р 50922-96).
- Угроза = вероятность + опасность
- Наличие угрозы не подразумевает атаку на систему, но говорит о её вероятности.
- Угроза ➡ (вероятность) ➡ ущерб

**ИБ: источник угрозы безопасности информации**
- Источник угрозы безопасности информации — субъект, являющийся непосредственной причиной возникновения угрозы безопасности информации: авторизованный пользователь, злоумышленник, насекомое.
- Уязвимость информационной системы — свойство системы, обусловливающее возможность реализации угроз безопасности информации

**Защита хоста**

**Антивирус** — средство защиты, предназначенное для определения и блокирования вредоносного ПО: вирусов, троянов, червей и т. д.

Основные подходы к обнаружению вредоносного ПО:
- сигнатурный — проверка по БД индикаторов
- поиск аномалий — анализ поведения
Варианты установки:
- на хосте
- на сервере, обычно подключаются как отдельные модули

**Хостовая система обнаружения вторжений (Host-based intrusion detection system, HIDS)** — средство защиты, предназначенное для анализа событий в динамике, происходящих на хосте.

Основные подходы к обнаружению вредоносного ПО:
- наблюдение за участками памяти
- наблюдение за выбранными файлами
- наблюдение за поведением системы
- наблюдение за логами

Песочница (sandbox) — тестовая среда для запуска ПО, изолированная от основной системы.

Дистрибутивы:
- seccomp (средство ядра Linux, ограничивает системные вызовы)
- Sandboxie
- Shade sandbox

**SELinux** — это система принудительного контроля доступа, реализованная на уровне ядра.

SELinux применяет систему дополнительной маркировки объектов ОС и определяет правила доступа каждого процесса к объектам на основе присвоенных меток. Такие правила объединяются и называются политикой

Режимы работы:
- Disabled
- Enforcing — блокировка в соответствии с заданными политикам
- Permissive — логирование в соответствии с заданными политикам.

**AppArmor** — модуль ядра Linux, обеспечивающий управление доступом на основе имён. Т. е. для каждой программы создаётся свой профиль, в котором указываются уровни доступа к каталогам, программам и системным ресурсам.
```
user@user:~$ sudo apt install apparmor-profiles apparmor-utils
apparmor-profiles-extra
```
Ссылка: gitlab.com/apparmor/apparmor

AppArmor: режимы работы
- Режим обучения (сообщения о действиях приложения):
```
user@user:~$ sudo aa-complain <путь к файлу>
```
- Режим ограничения согласно профилю:
```
user@user:~$ sudo aa-enforce <путь к файлу>
```
**PAM (Pluggable Authentication Modules, подключаемые модули аутентификации)** — набор библиотек, с помощью которых можно настроить методы аутентификации пользователей.

Типы модулей PAM:
- модули учётных записей
- модули аутентификации
- модули паролей
- модули сессий

**Ограничение попыток входа**

Структура каталогов PAM:
- /etc/pam.d/ — файлы конфигураций приложений
- /lib/security/ — модули PAM
- /etc/security/ — файлы конфигураций для PAM-окружений
- /usr/share/doc/pam-*/ — документация

**Шифрование**

**eCryptfs** — это POSIX-совместимая файловая система вложенного (stacked) шифрования. eCryptfs защищает файлы для любой файловой системы, раздела и т. д.

Установка:
```
user@user:~$ sudo apt install ecryptfs-utils
```
Шифрование домашнего каталога

Создание нового пользователя:
```
user@user:~$ sudo adduser --encrypt-home user2
```
Проверка шифрования:
```
user@user:~$ su - user2
user2@user:~$ touch 123, 456
user2@user:~$ exit
user@user:~$ sudo ls /home/user2/
Access-Your-Private-Data.desktop README.txt
```
Миграция домашнего каталога пользователя:
```
user@user:~$ sudo ecryptfs-migrate-home -u user1
```
Шифрование раздела swap:
```
user@user:~$ sudo ecryptfs-setup-swap
```
Информация для восстановления:
```
user@user:~$ ecryptfs-unwrap-passphrase
```
**LUKS (Linux Unified Key Setup)** — спецификация формата шифрования дисков, используемая в ОС Linux. При помощи LUKS могут быть зашифрованы диски, работающие в ОС Linux как в настольных компьютерах, так и в разнообразных устройствах, например, сетевых накопителях

**Установка LUKS**

Подготовка диска:
```
user@user:~$ sudo apt install gparted
```
Установка LUKS (должна быть установлено по умолчанию):
```
user@user:~$ sudo apt-get install cryptsetup
```
Проверка установки:
```
user@user:~$ cryptsetup --version
```
**Шифрование раздела LUKS**

Подготовка раздела (luksFormat):
```
user@user:~$ sudo cryptsetup -y -v --type luks2 luksFormat /dev/sdb1
```
Монтирование раздела:
```
user@user:~$ sudo cryptsetup luksOpen /dev/sdb1 disk
user@user:~$ ls /dev/mapper/disk
```
Форматирование раздела:
```
user@user:~$ sudo dd if=/dev/zero of=/dev/mapper/disk
user@user:~$ sudo mkfs.ext4 /dev/mapper/disk
```
Шифрование раздела LUKS

Монтирование «открытого» раздела:
```
user@user:~$ mkdir .secret
user@user:~$ sudo mount /dev/mapper/disk .secret/
```
Завершение работы:
```
user@user:~$ sudo umount .secret
user@user:~$ sudo cryptsetup luksClose disk
```

# network-protection
Защита сети

**Межсетевые экраны**

Межсетевой экран (файрвол, firewall; брандмауэр, brandmauer) — программный или программно-аппаратный модуль, осуществляющий блокирование сетевого трафика по заданным правилам или алгоритмам.

Типы межсетевых экранов:
- пакетный фильтр
- stateful firewall
- firewall NG

**Система Обнаружения Вторжений (Intrusion Detection System, IDS)** — программное или аппаратное решение, определяющее вредоносную активность в системе или сетевом трафике.

**Система Предотвращения Вторжений (Intrusion Prevention Systems, IPS)** — программное или аппаратное решение, предотвращающее вредоносную активность в системе или сетевом трафике

**СОВ: типы СОВ**

По подключению:
- сетевая СОВ (Network-based IDS, NIDS)
- локальная СОВ (Host-based IDS, HIDS)
По методу обнаружения аномалий:
- сигнатурный поиск (Signature-based detection)
- статистическое определение аномалий (Statistical anomaly-based detection)

**СОВ: недостатки СОВ**
- Наличие ложно-позитивных срабатываний
- Необходимо постоянное обновление правил
- Существует временной лаг между появлением уязвимостей и созданием правил для их обнаружения
- Невозможна обработка зашифрованного трафика
- Почти невозможно определить уязвимости, вызванные неправильной настройкой: слабая аутентификации и т. д

**Suricata** — сетевая IDS с открытым исходным кодом, разрабатываемая Open Security Foundation (OISF)
- Сайт: suricata-ids.org
- Исходный код: github.com/OISF/suricata

**Suricata: установка**
```
user@user:~$ sudo apt install software-properties-common
user@user:~$ sudo add-apt-repository ppa:oisf/suricata-stable
user@user:~$ sudo apt update
user@user:~$ sudo apt install suricata
user@user:~$ sudo suricata-update
```
Проверка установки:
```
user@user:~$ sudo systemctl status suricata
```
**Suricata: настройка**
```
user@user:~$ sudo nano /etc/suricata/suricata.yaml
```
И меняем значение параметра EXTERNAL_NET на "any"
```
user@user:~$ sudo systemctl restart suricata
```
Лог-файлы:
```
user@user:~$ sudo tail /var/log/suricata/suricata.log
user@user:~$ sudo tail /var/log/suricata/stats.log
```
**Suricata: запуск**
```
ubuntu@ubuntu:~$ sudo suricata -c /etc/suricata/suricata.yaml -i enp0s8 - где параметр “i” указывает прослушиваемый интерфейс
```
откроем лог-файл, в котором будут отображаться предупреждения:
```
ubuntu@ubuntu:~$ sudo tail -f /var/log/suricata/fast.log
```

**ARP-spoofing** — атака, использующая особенность протокола ARP, которая позволяет обработать ARP-ответ без предварительного ARP- запроса. Протокол ARP не сохраняет своё состояние, stateless protocol.
Такая атака позволяет злоумышленнику перехватывать трафик между узлами локальной сети и является разновидностью MITM-атак (Man In The Middle, человек посередине)

**MITM** (Man In The Middle, человек посередине, атака посредника) — атака, в результате которой атакующий скрытно принимает и передаёт информацию между двумя узлами. При этом атакуемые узлы считают, что общаются друг с другом напряму

**ARP-spoofing: статические arp-записи**

Плюсы:
- записи, добавленные в ARP-таблицу вручную, имеют приоритет над динамическими
- протокол ARP можно вообще отключить
Минусы:
- на каждом хосте нужно создать ARP-таблицу из N-1 записей
- при каждой замене оборудования или подключении нового, нужно перенастраивать все хосты

**ARP-spoofing: защита на уровне ядра ОС**

Для ядер Linux/FreeBSD существует патч, позволяющий значительно понизить вероятность успешного выполнения ARP-spoofing.

Метод состоит в следующем:
1. При изменении MAC-адрес посылается ARP-запрос, требующий всем хостам сообщить свои MAC-адреса
2. Если выполняется атака, то по дублированию ответов она будет обнаружена
3. Если изменение MAC-адреса произошло стандартно, то ответа, содержащего старый MAC-адрес, не будет

**ARP-spoofing: VLAN**

Разбиение сети при помощи VLAN не предотвращает атаку ARP-spoofing, но ограничивает её развитие. ARP-запросы не могут переходить из одного VLAN в другой. Частным случаем, неприменимым в реальных офисных сетях, является создание VLAN на каждый порт коммутатора и добавление в него только одного хоста. В такой ситуации ARP-spoofing не имеет смысла.

**ARP-spoofing: DAI**

Динамическая проверка ARP (Dynamic ARP inspection, DAI) — функция защиты от ARP-атак на стороне коммутатора. Для правильной работы DAI на коммутаторе необходимо указать доверенные (другой коммутатор) и ненадёжные (клиенты) порты.

Коммутатор проверяет соответствие IP- и MAC-адресов на ненадёжных портах по:
- базе данных DHCP
- статическим записям

**ARP-spoofing: защита на прикладном уровне**
- XArp — программа, отслеживающая соответствие между IP и MAC- адресами. В случае обнаружения несоответствия, сообщает об этом пользователю.
- XArp сначала анализирует ARP-таблицу, запоминает все полученные ARP-ответы и создаёт свою собственную таблицу IP- и MAC-адресов. Если это соответствие нарушается или в сети появляются новые адреса, об этом будет выдано сообщение в системный журнал. Защиты на прикладном уровне лучше всего запускать на SPAN- интерфейсе

**Fail2Ban: ограничение скорости перебора**

Самым простым решением ограничения скорости перебора паролей, является ограничение в доступе, или бан, для адреса, с которого производится атака.

Для решения этой задачи существуют:
- Fail2Ban
- ipban
- DenyHosts

**Fail2Ban** — одна из узкоспециализированных систем обнаружения вторжений (СОВ, Intrusion Prevention Software, IPS). Fail2Ban сканирует лог-файлы, находит в них странное сетевое поведение, например, ошибки набора пароля, и блокирует подозрительные адреса IP-адреса на заданное время

**Web-трафик**
- Web-трафик сейчас составляет большую часть трафика в корпоративных сетях
- Web-трафик бывает двух типов:
- - исходящий — сотрудники компании выходят в интернет
- - входящий — пользователи из интернета подключаются к публикуемым web-порталам

**Защита исходящего трафика**

Для защиты исходящего трафика применяются прокси-сервера. Типовые функции: работа с HTTPs, антивирус, URL фильтрация (категории сайтов), возможность фильтрации по типу файлов

**Защита входящего трафика**

Для защиты входящего web-трафика применяются Web Application Firewall (WAF):
- обеспечивает комплексную защиту от атак на веб-приложения
- учитывает логику работы веб-приложений: сессии, cookies и т. д.
- защищает веб-приложения лучше межсетевых экранов и систем обнаружения вторжений
- предоставляет защиту от веб-атак: SQL-инъекций, межсайтового скриптинга, небезопасных конфигураций и т. д.
- определяет и блокирует уязвимости веб-приложений — «виртуальный патчинг»

**Honeypot (приманка, ловушка)** — система, предназначенная для обнаружения компьютерных атак через имитацию работы реальной системы

**Honeypot: типы**
- Полная эмуляция системы (Pure honeypot)
- Высокоинтерактивные (High-interaction honeypot)
- Низкоинтерактивные (Low-interaction honeypot)

**Honeypot: недостатки**
- Если ловушка плохо настроена, её легко распознать
- Ловушка может обнаружить только атаку на саму ловушку
- Если ловушка распознана, на неё можно совершить «атаку», чтобы отвлечь от реальных действий в системе
- Если ловушка содержит уязвимости, через неё можно атаковать систему

# Лучшие практики современной информационной безопасности
 
Современная информационная безопасность (ИБ) — это комплекс мероприятий, направленный на защиту информации от угроз и опасности несанкционированного доступа, использования, раскрытия, изменения, порчи или уничтожения. Сегодня ИБ стала особенно важной из-за роста объёмов и значимости информации, которая хранится и обрабатывается в компьютерных системах. Это касается как государственных структур, так и частных компаний и организаций. Современные угрозы включают в себя киберпреступность, шпионаж, хакерские атаки, вирусы и многие другие формы злоумышленного поведения. Для защиты информации используются различные методы, включая шифрование, контроль доступа, мониторинг и обнаружение инцидентов, а также обучение персонала и проведение аудитов. Однако, как и сама технология, угрозы постоянно меняются и усложняются, поэтому вопросы ИБ должны оставаться приоритетными для всех, кто работает с компьютерной информацией.


